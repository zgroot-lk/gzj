# 学生管理系统 - 完整部署指南（Windows）

## 📋 前置要求

1. **Java JDK 17+**（已安装 ✓）
2. **Node.js 16+** 和 **npm**（已安装 ✓）
3. **MySQL 8.0+**（已安装 ✓）
4. **IntelliJ IDEA**（已安装 ✓）
5. **Git**（已安装 ✓）

---

## 🚀 完整部署步骤

### 第一步：清理旧环境（如果之前部署过）

```powershell
# 1. 删除旧的项目目录
cd C:\Users\LENOVO\Desktop
rm -r -Force gzj-main -ErrorAction SilentlyContinue

# 2. 停止 MySQL 中可能存在的旧数据库（可选）
mysql -u root -p
# 在 MySQL 中执行：
DROP DATABASE IF EXISTS student_management;
EXIT;
```

---

### 第二步：重新克隆项目

```powershell
# 进入桌面目录
cd C:\Users\LENOVO\Desktop

# 克隆项目
git clone https://github.com/zgroot-lk/gzj.git gzj-main

# 进入项目目录
cd gzj-main
```

---

### 第三步：配置 MySQL 数据库

#### 3.1 创建数据库（使用正确的字符集）

```powershell
# 登录 MySQL
mysql -u root -p
```

在 MySQL 命令行中执行：

```sql
-- 创建数据库（使用 utf8mb4 字符集）
CREATE DATABASE student_management CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 验证数据库创建成功
SHOW CREATE DATABASE student_management;

-- 退出 MySQL
EXIT;
```

#### 3.2 导入表结构

**重要**：确保使用正确的字符集参数，兼容 MySQL 8.0.44

```powershell
# 在 PowerShell 中执行（替换为你的 MySQL 密码）
mysql -u root -p你的密码 --default-character-set=utf8mb4 student_management < database/schema.sql
```

或者使用 MySQL 命令行（推荐，可以查看详细输出）：

```powershell
mysql -u root -p
```

```sql
USE student_management;

-- 设置字符集
SET NAMES utf8mb4;

-- 执行表结构脚本
SOURCE C:/Users/LENOVO/Desktop/gzj-main/database/schema.sql;

-- 验证表创建成功
SHOW TABLES;

-- 应该看到 7 张表：classes, students, student_records, schedules, attendance, grades, todos

EXIT;
```

**注意**：如果使用 MySQL 8.0.44，schema.sql 已经优化兼容，应该不会出现错误。

#### 3.3 导入初始数据

```powershell
# 在 PowerShell 中执行（设置字符集）
mysql -u root -p你的密码 --default-character-set=utf8mb4 student_management < database/init.sql
```

或者使用 MySQL 命令行：

```powershell
mysql -u root -p
```

```sql
USE student_management;
SET NAMES utf8mb4;
SOURCE C:/Users/LENOVO/Desktop/gzj-main/database/init.sql;

-- 验证数据导入成功
SELECT COUNT(*) FROM classes;
SELECT COUNT(*) FROM students;
SELECT COUNT(*) FROM student_records;
EXIT;
```

应该看到：

- classes: 5 条
- students: 6 条
- student_records: 6 条

---

### 第四步：配置后端（Java Spring Boot）

#### 4.1 在 IDEA 中打开项目

1. 打开 IntelliJ IDEA
2. `File → Open` → 选择 `C:\Users\LENOVO\Desktop\gzj-main`
3. 等待 IDEA 自动识别 Maven 项目并下载依赖

#### 4.2 配置数据库连接信息

打开 `src/main/resources/application.yml`，修改数据库密码：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/student_management?useUnicode=true&characterEncoding=utf8mb4&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: root
    password: 你的MySQL密码 # ⚠️ 这里改成你的 MySQL root 密码
```

#### 4.3 配置项目 SDK

1. `File → Project Structure → Project`
2. 设置 **Project SDK** 为 **JDK 17**
3. 设置 **Project language level** 为 **17**
4. 点击 **OK**

#### 4.4 重新加载 Maven 项目

1. 在 IDEA 右侧找到 **Maven** 面板
2. 点击刷新图标（Reload All Maven Projects）
3. 等待依赖下载完成

---

### 第五步：启动后端

#### 方式一：使用 IDEA 运行（推荐）

1. 找到 `src/main/java/com/student/StudentManagementApplication.java`
2. 右键 → `Run 'StudentManagementApplication'`
3. 等待启动完成（看到 `Started StudentManagementApplication` 表示成功）

#### 方式二：使用 Maven 命令

在 IDEA 的 Terminal 中执行：

```powershell
mvn spring-boot:run
```

#### 验证后端启动成功

在浏览器访问：`http://localhost:3001/api/todos`

如果返回 JSON 数据（即使是空数组 `[]`），说明后端启动成功。

---

### 第六步：配置前端

#### 6.1 安装前端依赖

```powershell
# 进入 client 目录
cd C:\Users\LENOVO\Desktop\gzj-main\client

# 设置 npm 镜像源（加速下载）
npm config set registry https://registry.npmmirror.com

# 安装依赖
npm install
```

等待安装完成（会看到 `added XXX packages`）。

#### 6.2 启动前端

```powershell
# 确保在 client 目录下
npm start
```

前端会自动在浏览器打开 `http://localhost:3000`

---

### 第七步：验证系统运行

1. **后端 API**：访问 `http://localhost:3001/api/todos`，应该返回 JSON 数据
2. **前端页面**：访问 `http://localhost:3000`，应该能看到学生管理系统界面
3. **数据展示**：前端页面应该能看到：
   - 班级管理：5 个班级
   - 学生管理：6 个学生
   - 其他模块的数据

---

## 🔧 常见问题排查

### 问题 1：后端启动失败 - 数据库连接错误

**错误**：`Access denied for user 'root'@'localhost'`

**解决**：

- 检查 `application.yml` 中的 `password:` 是否填写了正确的 MySQL 密码
- 确认 MySQL 服务已启动

### 问题 2：后端启动失败 - 字符编码错误

**错误**：`Incorrect string value`

**解决**：

- 确保数据库创建时使用了 `CHARACTER SET utf8mb4`
- 确保执行 `schema.sql` 和 `init.sql` 时使用了 `--default-character-set=utf8mb4`

### 问题 3：前端启动失败 - npm 命令不存在

**错误**：`npm 不是内部或外部命令`

**解决**：

- 确认 Node.js 已安装：`node --version`
- 确认 npm 已安装：`npm --version`
- 如果未安装，访问 https://nodejs.org/ 下载安装

### 问题 4：前端启动失败 - react-scripts 不存在

**错误**：`react-scripts 不是内部或外部命令`

**解决**：

```powershell
cd C:\Users\LENOVO\Desktop\gzj-main\client
rm -r -Force node_modules -ErrorAction SilentlyContinue
npm install
```

### 问题 5：前端页面显示"加载数据失败"

**解决**：

- 确认后端已启动（访问 `http://localhost:3001/api/todos` 能返回数据）
- 检查浏览器控制台（F12）的错误信息
- 确认后端端口是 3001，前端端口是 3000

---

## 📝 完整命令清单（复制粘贴版）

### 1. 清理并重新克隆

```powershell
cd C:\Users\LENOVO\Desktop
rm -r -Force gzj-main -ErrorAction SilentlyContinue
git clone https://github.com/zgroot-lk/gzj.git gzj-main
cd gzj-main
```

### 2. 创建数据库并导入数据

```powershell
# 登录 MySQL（替换为你的密码）
mysql -u root -p你的密码
```

```sql
CREATE DATABASE student_management CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
EXIT;
```

```powershell
# 导入表结构
mysql -u root -p你的密码 --default-character-set=utf8mb4 student_management < database/schema.sql

# 导入初始数据
mysql -u root -p你的密码 --default-character-set=utf8mb4 student_management < database/init.sql
```

### 3. 配置后端并启动

1. 在 IDEA 中打开项目
2. 修改 `src/main/resources/application.yml` 中的数据库密码
3. 运行 `StudentManagementApplication.java`

### 4. 启动前端

```powershell
cd C:\Users\LENOVO\Desktop\gzj-main\client
npm config set registry https://registry.npmmirror.com
npm install
npm start
```

---

## ✅ 部署完成检查清单

- [ ] 数据库 `student_management` 已创建（字符集 utf8mb4）
- [ ] 表结构已导入（7 张表）
- [ ] 初始数据已导入（有测试数据）
- [ ] `application.yml` 中数据库密码已配置
- [ ] 后端已启动（端口 3001）
- [ ] 前端已启动（端口 3000）
- [ ] 浏览器能访问前端页面
- [ ] 前端页面能显示数据

---

## 🎉 完成！

如果所有步骤都完成，你应该能看到完整的学生管理系统界面，并且有测试数据。

如果遇到任何问题，请检查：

1. MySQL 服务是否运行
2. 数据库密码是否正确
3. 端口 3001 和 3000 是否被占用
4. 浏览器控制台（F12）的错误信息
